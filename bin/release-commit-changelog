#!/bin/bash
#

set -o errexit

function usage { echo "Usage: $(basename $0) VERSION"; }
declare -r version="$1"
[[ -z "$version" ]] && usage && die

declare -r file=$(changelog-find-file)
if [[ "$file" == *releasenotes* ]]; then
    declare -r commitmsg="Release notes $version"
else
    declare -r commitmsg="Changelog $version"
fi


if changelog-file-exists &&
        repo-is-the-only-modified-file $file &&
        ( repo-diff-additions | changelog-has-header $version ); then

    repo-commit-all "$commitmsg"
fi

exit 0
